{% extends 'admin/layout.twig' %}

{% block content %}

<div class="col-lg-12 col-md-12 col-xs-12">
    <h3 style="text-align: right">Hi {{ user.first_name }}!</h3>
    <h5 style="text-align: right"><a href="{{ path('admin_logout') }}">Logout</a></h5>
</div>

<div class="col-lg-2 col-md-2 col-xs-12">
    <h3 class="list-head hd">Admin Menu</h3>
    <h5  class="list-subitem hd" onclick="toggleMenus($(this))" data-toggle="collapse" data-target="websiteDiv" style="cursor: pointer;">Manage Websites</h5>
    <h5  class="list-subitem hd" onclick="toggleMenus($(this))" data-toggle="collapse" data-target="usersDiv" style="cursor: pointer;">Manage Users</h5>
    <div class="col-xs-12"><hr></div>
    <h5  class="list-subitem hd" onclick="toggleMenus($(this))" data-toggle="collapse" data-target="personalInfo" style="cursor: pointer;">Change my info</h5>
</div>

<div id="personalInfo" class="collapse container col-lg-7 col-md-7 col-sm-10">
    {% include 'admin/personalInfoForm.twig' %}
</div>

<div id="usersDiv" class="collapse container col-lg-7 col-md-7 col-sm-10">
    {% include 'admin/users.twig' %}
</div>

<div id="websiteDiv" class="collapse in container col-lg-7 col-md-7 col-sm-10">
    <div>
        <h3>Websites list</h3>
        <table id="websites">
                <thead>
                    <tr><th></th><th></th><th></th><th>
                </thead>
                <tbody>
                </tbody>
        </table>
    </div>
    <br/>
    <div>
        <a href="/admin/site/create"><button class='btn btn-success'>Aggiungi sito</button></a>
    </div>
</div>

<script>
    $(document).ready( function () {

        $("#websites").dataTable({
            "aaData":[
                {% for website in websites %}
                    {% if loop.index > 1 %},{% endif %}
                    ["<h3>{{website.domain}}</h3>",
                    "<a href='/admin/site/edit/{{website.domain}}'><button class='btn btn-success'>Modifica</button></a>",
                    "<a href='/preview/{{website.domain}}'><button class='btn btn-success'>Anteprima Sito</button></a>"{% if website.getDraftNames() is not empty %},
                    "{% for draftName in website.getDraftNames() %}<a href='/preview/{{website.domain}}/{{draftName}}/{{website.getPageNames|first}}'><button class='btn btn-xs {% if loop.index == 1 %} regular'>Preview1{% elseif loop.index == 2 %} gold'>Preview2{% else %}'>Preview3{% endif %}</button></a>{% endfor %}"{% else %}," "{% endif %}]
                {% endfor %}
            ],
         "autoWidth": true
        });
    });
</script>
<script type="text/javascript">
function toggleMenus(toggleId){
    $('.in').collapse('toggle');
    $('#'+toggleId.context.dataset.target).addClass('in');
}
</script>

{% endblock %}
